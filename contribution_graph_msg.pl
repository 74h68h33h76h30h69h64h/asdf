#!/usr/bin/env perl

use 5.010;
use strict;
use warnings;
use DateTime;
use Data::Dumper;
use Getopt::Long;
use File::Path qw(remove_tree);

sub new {
    my $self = shift;
    my $hash = {
        message => 'hire me',
        letters => {
            'A' => {
                'blocks_w' => 5,
                'points' => [
                    [0, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                ],
            },
            'B' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 0, 0],
                ],
            },
            'C' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 1, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 1, 1, 1, 0],
                ],
            },
            'D' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 0, 0],
                ],
            },
            'E' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 1, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 1, 1, 1, 0],
                ],
            },
            'F' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 1, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                ],
            },
            'G' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 1, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 1, 0],
                ],
            },
            'H' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                ],
            },
            'I' => {
                'blocks_w' => 4,
                'points' => [
                    [1, 1, 1, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [1, 1, 1, 0],
                ],
            },
            'J' => {
                'blocks_w' => 5,
                'points' => [
                    [0, 1, 1, 1, 0],
                    [0, 0, 1, 0, 0],
                    [0, 0, 1, 0, 0],
                    [0, 0, 1, 0, 0],
                    [1, 0, 1, 0, 0],
                    [1, 0, 1, 0, 0],
                    [1, 1, 1, 0, 0],
                ],
            },
            'K' => {
                'blocks_w' => 4,
                'points' => [
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [1, 1, 0, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                ],
            },
            'L' => {
                'blocks_w' => 4,
                'points' => [
                    [1, 0, 0, 0],
                    [1, 0, 0, 0],
                    [1, 0, 0, 0],
                    [1, 0, 0, 0],
                    [1, 0, 0, 0],
                    [1, 0, 0, 0],
                    [1, 1, 1, 0],
                ],
            },
            'M' => {
                'blocks_w' => 6,
                'points' => [
                    [1, 1, 0, 1, 1, 0],
                    [1, 0, 1, 0, 1, 0],
                    [1, 0, 1, 0, 1, 0],
                    [1, 0, 1, 0, 1, 0],
                    [1, 0, 1, 0, 1, 0],
                    [1, 0, 0, 0, 1, 0],
                    [1, 0, 0, 0, 1, 0],
                ],
            },
            'N' => {
                'blocks_w' => 6,
                'points' => [
                    [1, 0, 0, 0, 1, 0],
                    [1, 1, 0, 0, 1, 0],
                    [1, 1, 0, 0, 1, 0],
                    [1, 0, 1, 0, 1, 0],
                    [1, 0, 1, 0, 1, 0],
                    [1, 0, 0, 1, 1, 0],
                    [1, 0, 0, 1, 1, 0],
                ],
            },
            'O' => {
                'blocks_w' => 5,
                'points' => [
                    [0, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [0, 1, 1, 0, 0],
                ],
            },
            'P' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0],
                ],
            },
            'Q' => {
                'blocks_w' => 5,
                'points' => [
                    [0, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [0, 1, 1, 0, 1],
                ],
            },
            'R' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 1, 1, 0, 0],
                    [1, 0, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                ],
            },
            'S' => {
                'blocks_w' => 5,
                'points' => [
                    [0, 1, 1, 0, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 0, 0],
                    [0, 1, 1, 0, 0],
                    [0, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [0, 1, 1, 0, 0],
                ],
            },
            'T' => {
                'blocks_w' => 4,
                'points' => [
                    [1, 1, 1, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                ],
            },
            'U' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [1, 0, 0, 1, 0],
                    [0, 1, 1, 0, 0],
                ],
            },
            'V' => {
                'blocks_w' => 6,
                'points' => [
                    [1, 0, 0, 0, 1, 0],
                    [1, 0, 0, 0, 1, 0],
                    [1, 0, 0, 0, 1, 0],
                    [1, 0, 0, 0, 1, 0],
                    [1, 0, 0, 0, 1, 0],
                    [0, 1, 0, 1, 0, 0],
                    [0, 0, 1, 0, 0, 0],
                ],
            },
            'X' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [0, 1, 0, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                ],
            },
            'X' => {
                'blocks_w' => 5,
                'points' => [
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [1, 0, 1, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                    [0, 1, 0, 0],
                ],
            },
            'Z' => {
                'blocks_w' => 6,
                'points' => [
                    [1, 1, 1, 1, 1, 0],
                    [0, 0, 0, 0, 1, 0],
                    [0, 0, 0, 1, 0, 0],
                    [0, 0, 1, 0, 0, 0],
                    [0, 1, 0, 0, 0, 0],
                    [1, 0, 0, 0, 0, 0],
                    [1, 1, 1, 1, 1, 0],
                ],
            },
            ' ' => {
                'blocks_w' => 3,
                'points' => [
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0],
                ],
            },
        },
    };

    GetOptions(
        'a|author=s'  => \$hash->{'author' },
        'e|email=s'   => \$hash->{'email'  },
        'm|message=s' => \$hash->{'message'},
    );

    return bless $hash, $self;
}

sub main {
    my $self = shift;
    my $start_date = DateTime->now;
    my $curr_date;

    $start_date->subtract(
        years => 1,
        days  => 2,
    );

    $curr_date = $start_date;

    eval { remove_tree('.git') };
    eval { remove_tree('temp') };

    mkdir('temp', 0755);

    `git init . && git add .`;

    my @letters  = split(//, $self->{'message'});
    my $x_column = 0;

    for (my $i = 0; $i < length($self->{'message'}); ++$i) {
        my $letter = uc($letters[ $i ]);
        my $l = $self->{'letters'}->{ $letter }; 
		say $letter;
        for (my $w = 0; $w < $l->{'blocks_w'}; ++$w) {
            for (my $h = 0; $h < 7; ++$h) {
                if ($l->{'points'}->[ $h ]->[ $w ] == 1) {
					for (my $c = 0; $c < 10; ++$c) {
						$self->fake_commit($curr_date);
					}
                }
				else {
					$self->fake_commit($curr_date);
				}
            	$curr_date->add(days => 1);
            }
        }
        $x_column += $l->{'blocks_w'};
    }

    `git remote add origin git\@github.com:/74h68h33h76h30h69h64h/asdf.git`;
    `git push --force origin master`;
}

sub fake_commit {
    my $self  = shift;
    my $date  = shift;
    my $epoch = $date->epoch();
    my $file  = 'temp/' . $self->random_str();

    open(my $fh, '>', $file);
    say $fh $file;
    close($fh);

	utime $epoch, $epoch, $file;
    `git add $file`;
    `GIT_AUTHOR_DATE='$epoch' GIT_COMMITTER_DATE='$epoch' git commit -m 'asdf'`; 
}

sub random_str {
    my $self     = shift;
    my $strlen   = 25;
    my $str      = '';
    my @pool     = ("a".."z", "A".."Z", 0..9);
    my $poolsize = scalar(@pool);

    for (my $i = 0; $i < $strlen; ++$i) {
        $str .= $pool[ int(rand($poolsize)) ];
    }

    return $str;
}

1;

__PACKAGE__->new->main;
exit;
